{
    "collab_server" : "",
    "contents" : "library(scales)\nlibrary(dygraphs)\nlibrary(bit64)\nlibrary(xts)\nlibrary(forecast)\nlibrary(depmixS4)\nlibrary(data.table)\n\nrm(list=ls())\n\ndatafile <- fread(\"D:/Nitin/ROOT/Buurkracht/Data/Final Dataset/Export/afferden.csv\", sep=\";\", dec=\".\")\n\ncategory <- \"Elektra\"\n\n  if (category == \"Elektra\") {\n    energy_unit <- \"kWh\"\n    nat_avg = 9\n  } else { \n    energy_unit <- \"m^3\"\n    nat_avg <- 3.835\n  }\n  \n  house <- subset(\n    datafile, Postcode == \"5851AD\" & Huisnummer == \"11\" & EnergieType == \"Elektra\" )\n  \n  house$Datum <-\n    as.POSIXct(house$Datum, format = \"%Y-%m-%d %H:%M\", \n                       tz = \"Europe/Amsterdam\")\n  \n  house <-\n    subset(house, select = c(Datum, Register, Meetwaarde))\n  house$Register <- as.factor(house$Register)\n  houseWide <- dcast(house, Datum ~ Register, value.var = \"Meetwaarde\" )\n  if (length(levels(house$Register)) > 1){\n    houseWide$`2.8.0` <- houseWide$`2.8.0`* -1 }\n  houseWide$net <- houseWide$`1.8.0`+ houseWide$`2.8.0`\n  \n  energyxts <- as.xts.data.table(houseWide)\n  \n  #HMM\n  energy <- energyxts\n  k=3\n  set.seed(7)\n  #kmeans cluster\n  cl <- kmeans(coredata(energy)[,\"net\"], k, nstart = 25)\n  means <- as.vector(cl$centers)\n  sds <- sqrt(cl$tot.withinss / cl$size)\n  #Create HMM model\n  resp_init <- c(rbind(means,sds))\n  mod <- depmix(net~1, data=energy, nstates=k, respstart = resp_init)\n  fit.hmm <- fit(mod, verbose = F) #fit\n  probs <- posterior(fit.hmm)        \n  # Lets change the name\n  colnames(probs)[2:(k+1)] <- paste(\"S\",1:k, sep=\"-\")\n  # Create dta.frame\n  dfu <- data.table(cbind(datum=index(energy),net=coredata(energy)[,\"net\"], probs[,2:(k+1)]))\n  dfm <- as.xts.data.table(dfu)\n  dygraph(dfm)\n  dfm <- melt(dfu[1:100], id.vars = \"datum\",)\n  qplot(datum,value,data=dfm,geom=\"line\",\n        main = \"HMM\",\n        ylab = \"\") + \n    facet_grid(variable ~ ., scales=\"free_y\") + theme_bw()\n  \n  \n  date_range <- \"15min\"\n  if (date_range == \"Day\") {\n    energy <- apply.daily(energyxts, FUN=mean)\n  } else if (date_range == \"Week\") {\n    energy <- apply.weekly(energyxts, FUN=mean)\n  } else if (date_range == \"Month\") {\n    energy <- apply.monthly(energyxts, FUN=mean)\n  }  else if(date_range==\"15min\"){\n    energy <- energyxts\n  }\n  \n  acf(coredata(energy)[,\"net\"])\n  ar.fit <- auto.arima(coredata(energy)[,\"net\"], stepwise = FALSE, trace=TRUE)\n  ar.res <- data.table(date = index(energy), observed = coredata(energy)[,\"net\"], fit = as.vector(fitted(ar.fit)))\n  ar.fit\n  ar.res <- as.xts.data.table(ar.res)\n  #plot  \n  dygraph(ar.res, main = paste(\"fit: \", as.character(date_range)), group = \"arima\" ) %>%\n    dyOptions(colors = RColorBrewer::brewer.pal(6, \"Set2\"))  %>%\n    #dyHighlight(highlightSeriesOpts = list(strokeWidth = 2.5)) %>%\n    dyAxis(\"x\", drawGrid = T) %>%\n    dyAxis(\n      \"y\",axisLineWidth = 0.01,drawGrid = T ) %>%\n    dyOptions(includeZero = TRUE) \n  \n  \n  \n  \npo",
    "created" : 1499677339502.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2054189901",
    "id" : "A9DF7347",
    "lastKnownWriteTime" : 1499687317,
    "last_content_update" : 1499687317666,
    "path" : "D:/Nitin/ROOT/Buurkracht/Dashboard/Git/slimDashboard/test.R",
    "project_path" : "test.R",
    "properties" : {
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}